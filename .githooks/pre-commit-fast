#!/bin/bash
# Fast pre-commit hook for Scrybe (skips tests and audit)
# Use this for quick commits, CI will still run full checks

set -e

echo "ü¶â Scrybe Pre-Commit (Fast Mode)"
echo "================================"
echo ""

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Source cargo environment if needed
if [ -f "$HOME/.cargo/env" ]; then
    source "$HOME/.cargo/env"
fi

# 1. Format Check
echo "1Ô∏è‚É£  Running rustfmt..."
if cargo fmt --all -- --check; then
    echo -e "${GREEN}‚úì Code formatting check passed${NC}"
else
    echo -e "${RED}‚úó Code formatting check failed${NC}"
    echo -e "${YELLOW}Run 'cargo fmt --all' to fix formatting${NC}"
    exit 1
fi
echo ""

# 2. Clippy (only on changed files if possible, otherwise full)
echo "2Ô∏è‚É£  Running clippy..."
if cargo clippy --workspace --all-features -- -D warnings; then
    echo -e "${GREEN}‚úì Clippy passed${NC}"
else
    echo -e "${RED}‚úó Clippy found issues${NC}"
    exit 1
fi
echo ""

# 3. Build Check
echo "3Ô∏è‚É£  Running build check..."
if cargo build --workspace; then
    echo -e "${GREEN}‚úì Build succeeded${NC}"
else
    echo -e "${RED}‚úó Build failed${NC}"
    exit 1
fi
echo ""

echo -e "${YELLOW}Note: Skipped tests and security audit (CI will run them)${NC}"
echo -e "${GREEN}‚úì Fast pre-commit checks passed!${NC}"

exit 0
